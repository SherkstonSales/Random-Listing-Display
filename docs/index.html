<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Sherkston Listings</title>
  <style>
    html, body { height:100%; margin:0; background:#000; color:#fff; font-family: Arial, sans-serif; }
    #frame { width:100vw; height:100vh; border:0; }
    #hud {
      position: fixed; left: 12px; bottom: 12px;
      background: rgba(0,0,0,0.65); padding: 10px 12px;
      border-radius: 8px; font-size: 14px;
    }
  </style>
</head>
<body>
  <iframe id="frame"></iframe>

  <div id="hud">
    <b>Listings Rotation</b><br>
    <span id="status">Loading…</span><br>
    Space = Pause • → = Next • R = Shuffle
  </div>

<script>
  const ROTATE_SECONDS = 20;
  let listings = [], order = [], idx = 0, paused = false;

  const frame = document.getElementById('frame');
  const status = document.getElementById('status');

  function shuffle(a){for(let i=a.length-1;i>0;i--){let j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]]}return a}

  function show(){ frame.src = order[idx]; status.textContent = paused ? 'Paused' : 'Playing'; }
  function next(){ idx = (idx + 1) % order.length; show(); }

  setInterval(()=>{ if(!paused && order.length) next(); }, ROTATE_SECONDS*1000);

  document.addEventListener('keydown', e=>{
    if(e.code==='Space'){ paused=!paused; show(); }
    if(e.code==='ArrowRight') next();
    if(e.key==='r' || e.key==='R'){ order = shuffle([...listings]); idx=0; show(); }
  });

fetch('./listings.json', { cache:'no-store' })
  .then(r => r.json())
  .then(d => {
    listings = d.listings || [];
    if (!listings.length) {
      status.textContent = 'No listings found (listings.json is empty).';
      return; // IMPORTANT: don’t try to load iframe
    }
    order = shuffle([...listings]);
    show();
  })
  .catch(err => {
    status.textContent = 'Error loading listings.json';
    console.log(err);
  });

</script>
</body>
</html>
